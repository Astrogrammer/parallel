# Инструкция по использованию суперкомпьютера (кластера) ВГУ
## Часть 1. Как подключиться
Прежде чем пытаться установить подключение с кластером, убедитесь, что вам предоставлен к нему доступ. Для этого, как минимум, необходимо  
    а) распечатать и заполнить **заявление на регистрацию**;  
    б) сгенерировать и отправить **публичный SSH-ключ**.  

В случае, если оба пункта выполнены, в ближайшее время можно пробовать установить соединение. Для этого есть несколько основных способов.

### На Linux через терминал
1. Исполните команду `ssh login@hpc.cs.vsu.ru`, где `login` - ваши фамилия_ио **латиницей** (в точном соответствии с вашим заявлением).
2. При успешном подключении в конце приветственного текста вы увидите приглашение ко вводу: `login@node7:~$ `
3. Введите `mc` (Midnight Commander) для открытия файлового менеджера. Через него вы можете видеть все ваши файлы и перемещаться между каталогами. Для выхода нажмите `F10`.
4. Кроме того, доступны следующие опции:  
   `F3` - открыть файл на чтение  
   `F4` - открыть файл на редактирование  
   `F5` - скопировать файл из одного окна в другое  
   `F6` - переместить файл из одного окна в другое  
   `F8` - удалить файл  
5. Все доступные опции подписаны снизу. При открытии файла на запись вы тоже увидите список возможных команд. В частности, `F2` отвечает за сохранение файла.

### На Windows через PowerShell
1. В случае, если ваш SSH-ключ был сгенерирован командой `ssh-keygen -t rsa`, откройте PowerShell через `Win+X` ➔ `PowerShell`
2. Исполните команду `ssh login@hpc.cs.vsu.ru`, где `login` - ваши фамилия_ио **латиницей** (в точном соответствии с вашим заявлением).
3. При успешном подключении в конце приветственного текста вы увидите приглашение ко вводу: `login@node7:~$ `
4. Введите `mc` (Midnight Commander) для открытия файлового менеджера. Через него вы можете видеть все ваши файлы и перемещаться между каталогами. Для выхода нажмите `F10`.
5. Кроме того, доступны следующие опции:  
   `F3` - открыть файл на чтение  
   `F4` - открыть файл на редактирование  
   `F5` - скопировать файл из одного окна в другое  
   `F6` - переместить файл из одного окна в другое  
   `F8` - удалить файл  
6. Все доступные опции подписаны снизу. При открытии файла на запись вы тоже увидите список возможных команд. В частности, `F2` отвечает за сохранение файла.

### На Windows через PuTTY
1. В случае, если ваш SSH-ключ был сгенерирован программой *puttygen*, запустите программу *pageant*. Появится значок в трее, нажмите на него ПКМ. Выберите *Add key*. Выберите файл **приватного ключа**.
2. Запустите программу *PuTTY*. В поле *host* введите `hpc.cs.vsu.ru`. В поле под "Saved Sessions" введите свой логин формата `фамилия_ио` **латиницей** (в точном соответствии с вашим заявлением). Нажмите *Save* для сохранения учётных данных.
3. Нажмите `Open`. Для несохранённого пользователя откроется окно авторизации. Введите свой логин вышеприведённого формата, нажмите *Enter*. **Перед тем, как вводить первый символ**, убедитесь, что используется английская раскладка клавиатуры (иначе может выдать ошибку при верных данных).
4. При успешном подключении в конце приветственного текста вы увидите приглашение ко вводу: `login@node7:~$ `
5. Введите `mc` (Midnight Commander) для открытия файлового менеджера. Через него вы можете видеть все ваши файлы и перемещаться между каталогами. Для выхода нажмите `F10`.
6. Кроме того, доступны следующие опции:  
   `F3` - открыть файл на чтение  
   `F4` - открыть файл на редактирование  
   `F5` - скопировать файл из одного окна в другое  
   `F6` - переместить файл из одного окна в другое  
   `F8` - удалить файл  
7. Все доступные опции подписаны снизу. При открытии файла на запись вы тоже увидите список возможных команд. В частности, `F2` отвечает за сохранение файла.

### На Linux и Windows через Visual Studio Code
1. Установите VS Code.
2. В меню слева найдите *Extensions*. Установите расширение *Remote SSH* от Microsoft.
3. В меню слева найдите *Remote explorer*. Нажмите на значок "+" возле SSH (*New remote*).
4. Введите команду `ssh login@hpc.cs.vsu.ru`, где `login` - ваши фамилия_ио **латиницей** (в точном соответствии с вашим заявлением).
5. Нажмите на "➔" (*Connect in current window*). Согласитесь с тем, что вы подключаетесь к устаревшей версии ОС. Выберите первый предложенный путь к файлам конфигурации SSH.
6. В меню слева выберите *Explorer*. Затем *Open folder*. Нажмите ОК, соглашаясь перейти по стандартному пути вида `/beegfs/home/login`
7. *Yes, I trust the authors.*
8. Вы подключились к суперкомпьютеру. Уже сейчас вы можете редактировать файлы кода, создавать папки и т.п. Кроме того, можно скачивать файлы на локальный компьютер (*ПКМ* ➔ *Download...*), а также загружать их на сервер, перетаскивая мышью из проводника в VS Code.
9. Нажмите по рабочей папке правой кнопкой мыши, выберите *Open in Integrated terminal*. Откроется приглашение ко вводу вида  
`[login@head folder]$ `
10. Введите далее `ssh node7`. Появится новое приглашение вида `login@node7:~$ ` Теперь можно полноценно работать на кластере, загружать нужные модули и ставить задачи в очередь исполнения.

## Часть 2. Как обмениваться файлами.
Для того, чтобы запускать код на кластере, необходимо как-то его туда поместить. Первый и самый очевидный способ - создать нужный файл сразу на сервере. Однако это не всегда удобно, поэтому далее рассмотрим основные способы файлообмена.  
**Примечание:** в случае работы через *Visual Studio Code* вы уже имеете необходимые для этого инструменты.

### На Linux через проводник
1. Откройте файловый менеджер. К примеру, caja.
2. В меню *File* найдите опцию *Connect to server...*
3. Server: hpc.cs.vsu.ru  
   Port: 22  
   Type: SSH  
   Folder: /home/фамилия_ио  
   User Name: фамилия_ио  
   Password: не заполняется

   Здесь ваши фамилия_ио указываются **латиницей** (в точном соответствии с вашим заявлением). При желании можно поставить галочку "Add bookmark" и добавить закладку для последующего быстрого подключения.
4. Нажимайте *Connect*. При успешном подключении вы попадёте в свою папку и увидите несколько служебных папок и файлов, среди которых `.config`, `.ssh`, `.ubuntu_config`, `.bash_profile`, `.bashrc` и другие.
5. Теперь вы можете работать с вашей папкой на суперкомпьютере так, будто она является обычной папкой на локальной системе. Можно свободно редактировать и переносить файлы между системами.

### На Linux через терминал
1. Введите команду
```
scp /path/to/sending_file.txt login@hpc.cs.vsu.ru:~/path/to/destination_file.txt
```
Значок `~` обозначает вашу домашнюю папку на кластере. `login` - ваши фамилия_ио **латиницей** (в точном соответствии с вашим заявлением). Файл `sending_file.txt` будет **передан на кластер** и помещён в указанный каталог с именем `destinaton_file.txt`  

2. Введите команду
```
scp login@hpc.cs.vsu.ru:~/path/to/sending_file.txt /path/to/receiving_file.txt
```  
Файл `receiving_file.txt` будет **получен от кластера** и помещён в указанный каталог с именем `destinaton_file.txt`

### На Windows через WinSCP
1. Скачайте и установите программу *WinSCP*.
2. Запустите программу *pageant*. Появится значок в трее, нажмите на него ПКМ. Выберите *Add key*. Выберите файл **приватного ключа**.
3. Запустите *WinSCP*. Укажите параметры:  
   Protocol: SFTP  
   Host name: hpc.cs.vsu.ru  
   Port: 22  
   User name: фамилия_ио **латиницей**
5. Нажмите *Login*. В случае успешного подключения вы увидите список папок и файлов вашей домашней папки.
6. Сверху слева можно выбрать диск вашей локальной системы. В этом случае слева будут файлы локлаьного компьютера, а справа - файлы кластера. Можно копировать их в обе стороны через стандартные комбинации `CTRL+C`, `CTRL+V` и т.п. Кроме того, можно открывать текстовые файлы во встроенном редакторе с примитивным интерфейсом.
7. Чтобы отобразить скрытые папки и файлы, перейдите в *Panels* ➔ *Common* ➔ *Show hidden files*.

## Часть 3. Как загружать модули
Некоторые программы установлены на суперкомпьютере для всех по умолчанию и доступны сразу после входа. К ним относятся `gcc-13.1.0` и `python-3.6.9`. Однако в стандартный комплект не входит пакет `OpenMPI`, необходимый для работы с параллельными вычислениями через MPI. 

### Для временного использования
1. Исполните `module avail`, чтобы увидеть список всех доступных модулей.
2. Через `module load gcc/13.1.0` в явном виде загрузите `gcc-13.1.0`, чтобы получить расширенный список доступных модулей.
3. Повторно исполните `module avail`. Появились два новых доступных модуля: `openmpi-5.0.6` и `python-3.11.11`.
4. Исполните `module load openmpi-5.0.6`. Теперь нужный модуль загружен и можно работать с MPI. Проверить его доступность можно командой `mpirun --version`
5. При желании можно загрузить модуль `python-3.11.11`. Вместе с ним загрузятся также `openmpi-5.0.6`, `sqlite-3.49.0` и `scalapack-2.2.2`
6. Чтобы выгрузить отдельный модуль, выполните `module unload <name>`
7. Чтобы выгрузить все модули, выполните `module purge`
8. Модули будут оставаться загруженными **только до выхода из системы.** После повторного входа нужно будет загружать их заново.

### Для постоянного использования
В случае, если вы пользуетесь одним и тем же модулем постоянно, имеет смысл настроить его загрузку по умолчанию. Для этого:  
1. Исполните `mcedit ~/.ubuntu_config/.bashrc`
2. Перейдите в конец файла и добавьте команды, которые будут исполняться при каждом вашем входе в систему. Например, для модуля `openmpi-5.0.6` введите:
```
# Load OpenMPI
module load gcc/13.1.0
module load openmpi-5.0.6
```
3. Нажмите `F2` для сохранения файла.
4. Нажмите `F10` для выхода из редактора.
5. Перезайдите в систему. Проверьте, что команда `mpirun --version` существует и отрабатывает правильно.
